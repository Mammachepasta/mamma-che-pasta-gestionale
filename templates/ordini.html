{% extends "base.html" %}
{% block title %}Ordini{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Ordini</h2>
  <a href="{{ url_for('nuovo_ordine') }}" class="btn btn-primary btn-sm">Nuovo ordine</a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="alert alert-{{ category }} py-1 my-1">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<table class="table table-sm table-striped align-middle">
  <thead>
    <tr>
      <th>Data</th>
      <th>Cliente</th>
      <th>Kg totali</th>
      <th>Righe</th>
      <th>Azioni</th>
    </tr>
  </thead>
  <tbody>
    {% for o in ordini %}
    <tr>
      <td>{{ o.data }}</td>
      <td>
        {{ o.cliente_nome }}
        {% if o.cliente_codice %}
          <small class="text-muted">[{{ o.cliente_codice }}]</small>
        {% endif %}
      </td>
      <td>{{ "%.2f"|format(o.kg_totali or 0) }}</td>
      <td>{{ o.num_righe }}</td>
      <td>
        <a class="btn btn-sm btn-outline-secondary"
           href="{{ url_for('dettaglio_ordine', ordine_id=o.id) }}">
          Dettaglio
        </a>
        <a class="btn btn-sm btn-outline-success"
           href="{{ url_for('stampa_checklist', id=o.id) }}">
          Checklist
        </a>
        <form method="post"
              action="{{ url_for('elimina_ordine', ordine_id=o.id) }}"
              style="display:inline"
              onsubmit="return confirm('Eliminare questo ordine?');">
          <button type="submit" class="btn btn-sm btn-outline-danger">Elimina</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="5" class="text-center text-muted">
        Nessun ordine presente.
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
